import streamlit as st
import pdfplumber
import pandas as pd
import re
import urllib.parse
from rapidfuzz import process, fuzz

# Permanent Master List (Embedded from CSV)
master_list = {
    "Arias Tomas ": "5-1",
    "Chokkar Rudransha ": "5-1",
    "Choudhary Rayansh ": "5-1",
    "Benejam Graterol Gabriela De Dios": "5-1",
    "De la Rosa TomÃ¡s": "5-1",
    "Duffoo Limay Kiara Paola": "5-1",
    "Duque Lopez Tiago Josue": "5-1",
    "Fajardo Layla ": "5-1",
    "Garces Valeria ": "5-1",
    "Gonzalez Marrugo Sebastian": "5-1",
    "Guerra Paloma ": "5-1",
    "Kishore Aryan ": "5-1",
    "Llanos Landa Emiliana ": "5-1",
    "Moreno Escobar Paulina ": "5-1",
    "Moreno Juan Jose ": "5-1",
    "Munar Isabella ": "5-1",
    "Posada Matias ": "5-1",
    "Ramazanli Abdullah ": "5-1",
    "Ramirez Barrera Isaak ": "5-1",
    "Schwed Andres ": "5-1",
    "Vargas FlÃ³rez Valeria ": "5-1",
    "Viteri-Leroux Isabella ": "5-1",
    "Benitez Pablo ": "5-2",
    "Escobar Nicolas ": "5-2",
    "FernÃ¡ndez Violeta ": "5-2",
    "GÃ³ngora Bonilla Luciana ": "5-2",
    "Gutierrez Martina ": "5-2",
    "HerrÃ¡n Bonilla Lucas ": "5-2",
    "Labastida Andrea ": "5-2",
    "LiÃ©vano Roncancio Mariana ": "5-2",
    "McKenna Ramirez Liam ": "5-2",
    "Moncada Victoria ": "5-2",
    "NiÃ±o Ariza Gabriel": "5-2",
    "OrdoÃ±ez Santiago ": "5-2",
    "Paez MuÃ±oz Valeria ": "5-2",
    "Prieto Jacobo ": "5-2",
    "Ramirez Emilio ": "5-2",
    "Reynales Vargas Violeta ": "5-2",
    "Rodriguez Juan Miguel ": "5-2",
    "Romero Luciana ": "5-2",
    "Serpa Sergio ": "5-2",
    "Vargas Ortegon Maria Juliana ": "5-2",
    "Villamil Daniel ": "5-2",
    "Vives Eguis Ignacio ": "5-2",
    "Alvarez Mancina Isabella ": "5-3",
    "Arias Sandoval MartÃ­n Pablo ": "5-3",
    "Barreto Agudelo Juan Diego ": "5-3",
    "Bonilla Sarah": "5-3",
    "Castro Santiago ": "5-3",
    "Cubillos Garcia Antonia": "5-3",
    "De Urbina Mariana ": "5-3",
    "Ferreira Valerie ": "5-3",
    "Iriondo Tomas ": "5-3",
    "Martinez Bustillo Simona ": "5-3",
    "Mercado Victoria ": "5-3",
    "Murcia Sebastian ": "5-3",
    "Ochoa Tomas ": "5-3",
    "OrdoÃ±ez Nicolas ": "5-3",
    "Ortiz Luciana ": "5-3",
    "PinzÃ³n BarragÃ¡n JerÃ³nimo ": "5-3",
    "Press Emma ": "5-3",
    "Rico Luciana ": "5-3",
    "Rozo Alejandro ": "5-3",
    "Serrano Ortega Mariana ": "5-3",
    "Tovar Puyana Tomas": "5-3",
    "Urrego Emiliano ": "5-3",
    "Vizcaino David ": "5-3",
    "Arango Rey Lucas ": "5-4",
    "Arbelaez Duque TomÃ¡s ": "5-4",
    "ArÃ©valo Cardona Emiliana ": "5-4",
    "Chapman Iglesias Manuela ": "5-4",
    "Ferrer SofÃ­a ": "5-4",
    "Gomez Bonilla Juan Manuel ": "5-4",
    "Heinen SofÃ­a ": "5-4",
    "Hernandez Julieta ": "5-4",
    "Iriondo Miranda ": "5-4",
    "MarÃ­a Juan AndrÃ©s ": "5-4",
    "Mora Samuel ": "5-4",
    "Nieto Martina ": "5-4",
    "NiÃ±o RodrÃ­guez JerÃ³nimo ": "5-4",
    "Paredes Sebastian ": "5-4",
    "Ranea DoÃ±a Juan Ignacio": "5-4",
    "Robayo Sebastian ": "5-4",
    "RodrÃ­guez PeÃ±a Esteban ": "5-4",
    "Rojas Emiliano ": "5-4",
    "Rubiano Silvana ": "5-4",
    "Ruiz Mario ": "5-4",
    "Varon Luciana ": "5-4",
    "Atkinson Cruz Lucas": "6-1",
    "Beltran Tamara Jeronimo": "6-1",
    "Camargo Vargas Antonio": "6-1",
    "Cardenas Cardenas Samuel": "6-1",
    "Castellanos MejÃ­a MarÃ­a Paula": "6-1",
    "Chiara Aurelie Marie De Maupeou DÂ´ableiges": "6-1",
    "Daza Torres Eugenia SofÃ­a": "6-1",
    "Kumar Pandey Ayush": "6-1",
    "Maya Salas Juan Camilo": "6-1",
    "Molina Kackson Antonia Joy": "6-1",
    "Montenegro Berrocal Juan Felipe": "6-1",
    "Pedraza Soto Luciana": "6-1",
    "Roa Camacho Manuela": "6-1",
    "Roca Chilson Samuel": "6-1",
    "Stephens Maximo": "6-1",
    "TriviÃ±o Huertas Juan MartÃ­n": "6-1",
    "Valderrama Gutierrez Santiago": "6-1",
    "Vargas CÃ³rdoba Nathalia": "6-1",
    "Yunis OmaÃ±a MarÃ­a Antonella": "6-1",
    "Aldana Ocando Juan Eduardo": "6-2",
    "Bernal Franco Nicolas": "6-2",
    "Brasesco GonzÃ¡lez Stefano": "6-2",
    "Caballero RamÃ­rez Gabriela": "6-2",
    "Camacho Orozco Rafael": "6-2",
    "Cruz Jaramillo Santiago": "6-2",
    "JimÃ©nez Ocando Emma": "6-2",
    "Lamprea Delgado Maria Adelaida": "6-2",
    "Martinez Barrera Gabriela": "6-2",
    "MejÃ­a Bernal JoaquÃ­n": "6-2",
    "Neira Aristizabal Juan SebastiÃ¡n": "6-2",
    "PeÃ±a Hernandez Jose Alejandro": "6-2",
    "Quintero Montes Lucas": "6-2",
    "SÃ¡nchez Castilla Valeria": "6-2",
    "Sanchez Garcia Sofia": "6-2",
    "Urrea Moreno Maria Lucia": "6-2",
    "Valderrama Lenis Julieta": "6-2",
    "Acerbo Cuevas Luca": "6-3",
    "Atkinson Cruz Dylan": "6-3",
    "Barbosa Guerra Emilia": "6-3",
    "Bonilla Silva Manuela": "6-3",
    "Cortez Ladino Maria Fernanda": "6-3",
    "Costilla Cortina Antonio": "6-3",
    "Cuestas Rodriguez Danna Nicole": "6-3",
    "Gomez Nova Andres David": "6-3",
    "JimÃ©nez Basabe Juana": "6-3",
    "Lacouture Elias Juan Pablo": "6-3",
    "MarÃ­a Gaviria MartÃ­n ": "6-3",
    "Pardo Sabogal Camila": "6-3",
    "Poveda BolaÃ±os Isabella": "6-3",
    "Rodriguez Verdugo Juan Nicolas": "6-3",
    "Salazar Bayona Juan David": "6-3",
    "Troya More Matias": "6-3",
    "Valderrama Portocarrero Gabriel Fernando": "6-3",
    "Vanegas Zamora Luciana": "6-3",
    "VelandÃ­a Aldana Samuel Esteban": "6-3",
    "Aguilar BarÃ³n MatÃ­as": "6-4",
    "CÃ¡rdenas RamÃ­rez Briana EstefanÃ­a": "6-4",
    "Castellanos Soledad Alejandro": "6-4",
    "Castro SÃ¡nchez Isabella": "6-4",
    "FernÃ¡ndez Enciso SimÃ³n": "6-4",
    "Figueredo Fontalvo Alessandro": "6-4",
    "Leiva Perez JerÃ³nimo": "6-4",
    "Lozano Vanegas Isabella": "6-4",
    "MachacÃ³n Martinez Gabriela": "6-4",
    "Malo Anzola MatÃ­as": "6-4",
    "Molina BohÃ³rquez Santiago": "6-4",
    "Morales Centeno Alejandro": "6-4",
    "MuÃ±oz Parra Alejandra": "6-4",
    "MuÃ±oz Vacca Juan Felipe": "6-4",
    "Nobili Pittilini Clara": "6-4",
    "Nossa DÃ­az Mariana": "6-4",
    "Oswald Angulo Francisca Alejandra": "6-4",
    "Rojas Montejo Jorge Mauro": "6-4",
    "SÃ¡nchez Olmos Antonia": "6-4",
    "Sintura Salazar JerÃ³nimo": "6-4",
    "Suarez Villate Tomas": "6-4",
    "TriviÃ±o PiÃ±eros VerÃ³nica": "6-4",
    "Alvarez Herrera Daniella Sofia": "6-5",
    "Baez Suarez SofÃ­a": "6-5",
    "Cano Quijano Daniel Steven": "6-5",
    "CÃ¡rdenas GaÃ±an Luis Santiago": "6-5",
    "Casadiego Duran Samuel Eduardo": "6-5",
    "Castillo Tovar TomÃ¡s Camilo": "6-5",
    "Forero Acero Juanita": "6-5",
    "Giraldo PachÃ³n Danna": "6-5",
    "GuzmÃ¡n Echeverri MartÃ­n": "6-5",
    "Hurtado Borja Esteban": "6-5",
    "Juyar Prieto Emma SofÃ­a": "6-5",
    "Martinez Bernal SalomÃ©": "6-5",
    "MejÃ­a Macias Antonella": "6-5",
    "Molina Lugo Alejandro": "6-5",
    "PinzÃ³n Manrique SofÃ­a": "6-5",
    "Prieto Lozano MartÃ­n AndrÃ©s": "6-5",
    "Quintero Ortega Antonia": "6-5",
    "RincÃ³n Moreno MatÃ­as": "6-5",
    "Rojas Carvajal Emilio": "6-5",
    "Rueda Charry Emilio": "6-5",
    "VÃ¡squez Serrano Juan Felipe": "6-5",
    "VÃ©lez Moreno Paloma": "6-5",
    "Becerra Peralta,  MarÃ­a JosÃ©": "7-1",
    "Buendia Sepulveda Daniel": "7-1",
    "Contreras Duran Paola Andrea": "7-1",
    "Escobar Diaz Juan Martin ": "7-1",
    "Garcia Huertas Kyra Sophia": "7-1",
    "Garzon Hidalgo Sergio Esteban": "7-1",
    "Gomez Ochoa Lorenzo ": "7-1",
    "Herrera CufiÃ±o Maria Gabriela": "7-1",
    "Lara Laino Jeronimo": "7-1",
    "Pardo Lopez Sara": "7-1",
    "Pedrero Florez Santiago": "7-1",
    "PeÃ±uela Gomez Andres": "7-1",
    "Press Tobon Ilan": "7-1",
    "QuiÃ±ones Soler  Martin ": "7-1",
    "Restrepo Tobon  Valentina": "7-1",
    "Rey Ramirez, Matias": "7-1",
    "Rodriguez Rojas Jeronimo": "7-1",
    "Salcedo Brown,  Luna Loraine": "7-1",
    "Sandoval Hernandez MartÃ­n": "7-1",
    "Serna Amorocho Valentina": "7-1",
    "Tamayo Salazar, Amelia": "7-1",
    "Umbarila Cabrera Daniel Felipe": "7-1",
    "Wilches Hernandez,  Maria Jose": "7-1",
    "Anaya OmaÃ±a,  Luna Sofia": "7-2",
    "Arevalo Gallego Lorenzo": "7-2",
    "Carnevali Mesquita Spranger Manuela": "7-2",
    "Cavinato RamÃ­rez Luca": "7-2",
    "Chacon Gonzalez  Valeria ": "7-2",
    "Cruz Saenz  Anabella ": "7-2",
    "De La Espriella Caliz Manuella": "7-2",
    "Fajardo Alba SebastiÃ¡n": "7-2",
    "Fuquen Molano  Martin": "7-2",
    "JimÃ©nez Fadul MarÃ­a JosÃ©": "7-2",
    "LÃ³pez Moreno  Juan Jacobo": "7-2",
    "Olarte Estrada Isabela": "7-2",
    "Payro Lopez, Arturo": "7-2",
    "Pinilla Navia Alicia": "7-2",
    "Prem Nainish Vembu  Aniketa": "7-2",
    "Reales Gamboa Julieta": "7-2",
    "Rincon Suarez Sara Victoria": "7-2",
    "Salcedo Castillo Ana Victoria": "7-2",
    "Sandoval Ruge  Gabriella ": "7-2",
    "Tobias Morales  Jorge Santiago": "7-2",
    "Uribe Guiza Antonia": "7-2",
    "Varela Jimenez  Santiago ": "7-2",
    "Vargas CÃ³rdoba Felipe": "7-2",
    "Bayona Herrera  Jacobo ": "7-3",
    "Castellanos Moreno Juan AndrÃ©s": "7-3",
    "Certuche Rincon,  Joao Andres": "7-3",
    "Echeverry DurÃ¡n Samuel": "7-3",
    "Ferrari Cranwell, Diego": "7-3",
    "Jimenez Salamanca Veronica": "7-3",
    "Lozano Martinez David Jeronimo": "7-3",
    "Maldonado Puentes Gabriela": "7-3",
    "Martinez Morales Alejandra": "7-3",
    "Martinez Torres Gabriel Alfredo": "7-3",
    "Marume Benitez Sarah": "7-3",
    "Mendez Ruiz Isabella": "7-3",
    "Mercado MerchÃ¡n MatÃ­as": "7-3",
    "Quintero Ortega Luciana": "7-3",
    "Rubiano Rincon Emilio": "7-3",
    "Sanchez Cortes, Lorenzo": "7-3",
    "Saray Martinez, Mateo": "7-3",
    "Torres Lopez, Juana": "7-3",
    "Valero Pinzon Sebastian": "7-3",
    "Vasco Callejas Samuel": "7-3",
    "Yaya Ladino Isabella": "7-3",
    "Zabala Diaz Emily": "7-3",
    "Arevalo Rojas Manuel Esteban": "7-4",
    "Asseiceiro Ferreira Matias Daniel": "7-4",
    "Ayala Forero Camilo": "7-4",
    "Castillo Tovar SimÃ³n": "7-4",
    "Cerball Segura Nina Lucia": "7-4",
    "Cristancho Alzate Lucas": "7-4",
    "Diaz Upegui Sara": "7-4",
    "GÃ³ngora Santiago": "7-4",
    "GutiÃ©rrez Santos Emiliano": "7-4",
    "Hernandez Coral Ivana": "7-4",
    "HernÃ¡ndez Eslava Matias": "7-4",
    "Jimenez Fadul Juan Diego": "7-4",
    "Lozano Ardila Silvana": "7-4",
    "Natale Lapelosa Nicolas Carmelo": "7-4",
    "Nieto Gonzalez  Camila ": "7-4",
    "Orozco Cortes Matias": "7-4",
    "Orozco Herrera Maria Gabriela": "7-4",
    "Sanabria Puerta Luciano": "7-4",
    "Sanchez Cabrera  Maria Isabella": "7-4",
    "Saray Martinez Felipe": "7-4",
    "Sealy Rodriguez Aldair Elias ": "7-4",
    "TobÃ³n MarÃ­n Sofia": "7-4",
    "Aguilera Hidalgo, Juanita": "7-5",
    "Arellano Varon MartÃ­n AndrÃ©s": "7-5",
    "Ariza LondoÃ±o, SalomÃ©": "7-5",
    "Brasesco GonzÃ¡lez Enzo": "7-5",
    "Bustamente Cabrera Antonio": "7-5",
    "Camacho Forero Ana SofÃ­a ": "7-5",
    "Castro Bornacelli Daniel Felipe": "7-5",
    "FandiÃ±o PeÃ±a Samuel": "7-5",
    "Fernandez Enciso  Martin": "7-5",
    "Florez Roman,  Juan Andres": "7-5",
    "Gomez Carpintero Ane": "7-5",
    "Gonzalez Bonilla Manuela": "7-5",
    "Luque GarcÃ­a Catalina": "7-5",
    "Mc Kenna Ramirez Samuel Aidan": "7-5",
    "Navarro Cubides Pedro David": "7-5",
    "Ramirez Padilla, Matias": "7-5",
    "SÃ¡nchez Olmos Valeria": "7-5",
    "Sengar Riddhi": "7-5",
    "Tobon Pinilla  Juan Andres ": "7-5",
    "Valenzuela  Burbano Alejandro": "7-5",
    "Zarza Carbonell Daniel": "7-5",
    "Alpire Caballero Jazmin Mirtha": "8-1",
    "Bravo Hirsch Nicolas Ignacio": "8-1",
    "Calvache Bustos NicolÃ¡s": "8-1",
    "Camacho Orozco Camila": "8-1",
    "ChÃ¡vez Del Portillo Enrique Javier": "8-1",
    "Clavijo Vergara Camila": "8-1",
    "Echeverri Lozano Laura Alejandra": "8-1",
    "GualdrÃ³n SuÃ¡rez Manuela": "8-1",
    "Gunda Nirvigna": "8-1",
    "GuzmÃ¡n MartÃ­nez Alejandro": "8-1",
    "JimÃ©nez GarcÃ­a BÃ¡rbara": "8-1",
    "Liu Yicen": "8-1",
    "Ortiz HernÃ¡ndez MarÃ­a Juliana": "8-1",
    "Pillai Suryanarayanan V": "8-1",
    "Prem Nainish Vembu Anirudha": "8-1",
    "Pulido Tamayo Valeria Mae": "8-1",
    "Serna Saucedo Alejandro": "8-1",
    "Villa Herrera JerÃ³nimo": "8-1",
    "Viteri Leroux Abigail": "8-1",
    "Yepes PolanÃ­a AndrÃ©s": "8-1",
    "Arias Sandoval Manuela": "8-2",
    "BenÃ­tez Navarro Isabella": "8-2",
    "Blanco RibÃ³n Mariana Gabriela": "8-2",
    "CÃ¡ceres Moreno LucÃ­a": "8-2",
    "Castro Aranguren Mariana": "8-2",
    "Ferrer Villota Santiago": "8-2",
    "Granada RincÃ³n Antonia": "8-2",
    "Guerra Messier Samuel ": "8-2",
    "Jones Castellanos SimÃ³n": "8-2",
    "Leon Guarnizo Valentina": "8-2",
    "LÃ³pez CastrillÃ³n Luciana": "8-2",
    "MachacÃ³n MartÃ­nez SofÃ­a": "8-2",
    "MacÃ­as Ceballos Daniel": "8-2",
    "Montoya SÃ¡nchez Silvana": "8-2",
    "Moscoso Fajardo Santiago": "8-2",
    "Mosquera Garcia Lucia": "8-2",
    "Padilla Sebastian ": "8-2",
    "Rivera Forero Ana SofÃ­a": "8-2",
    "Rodriguez Estepa Maria Jose ": "8-2",
    "RoldÃ¡n Umbarila Federico": "8-2",
    "Rozo Lerzundy Antonio": "8-2",
    "Triana GonzÃ¡lez Valerie": "8-2",
    "Valbuena DÃ­az Gabriela": "8-2",
    "Vargas OrtegÃ³n Samuel": "8-2",
    "Arango Rey SofÃ­a": "8-3",
    "Ballesteros Ulloa MartÃ­n": "8-3",
    "Becerra Maya Valeria": "8-3",
    "Benitez Santiago ": "8-3",
    "Castillo Jaar Maria Paula ": "8-3",
    "Echeverri Lozano Luciana": "8-3",
    "Escobar Espinosa Santiago": "8-3",
    "Giraldo Pachon Salome": "8-3",
    "GualdrÃ³n Bocanegra Paula Mariana": "8-3",
    "Iriondo CortÃ©s SimÃ³n": "8-3",
    "Ladino Castilla Rebecca": "8-3",
    "Mesa Blanco Juan Lucas": "8-3",
    "Morales Ospina Samuel": "8-3",
    "Orjuela Henao MatÃ­as ": "8-3",
    "PeÃ±a Araque NicolÃ¡s": "8-3",
    "PinzÃ³n Casas Manuel Alejandro": "8-3",
    "Prieto Montenegro Gabriela": "8-3",
    "Romay Torres AndrÃ©s Ignacio": "8-3",
    "Sarmiento GuzmÃ¡n Mariana": "8-3",
    "TriviÃ±o PiÃ±eros Manuela ": "8-3",
    "VÃ¡squez Serrano NicolÃ¡s JosÃ©": "8-3",
    "Villamil BermÃºdez Sara LucÃ­a": "8-3",
    "Valero Mario ": "8-3",
    "Acevedo RamÃ­rez Juan SebastiÃ¡n": "8-4",
    "Ardila Mateus Juliana": "8-4",
    "Bedoya Delgadillo MarÃ­a Paz": "8-4",
    "Bravo Hirsch Fernando Arturo": "8-4",
    "Camacho Daza Mariana": "8-4",
    "Cormane LÃ³pez Isabella": "8-4",
    "De Castro Uribe Sara": "8-4",
    "DÃ­az HernÃ¡ndez Cesar AndrÃ©s": "8-4",
    "GonzÃ¡lez Del Gordo Santiago": "8-4",
    "Herrera Alvarado SofÃ­a Montserrat": "8-4",
    "Herrera Castro Manuela": "8-4",
    "Herrera GÃ³mez NicolÃ¡s": "8-4",
    "Ladino Chiquillo Silvana": "8-4",
    "Loaiza Rua MartÃ­n": "8-4",
    "Martinez Pinto Daniela ": "8-4",
    "Morales Cuellar Maria JosÃ©": "8-4",
    "Ramos Eslava Santiago": "8-4",
    "Rojas Silva Santiago": "8-4",
    "Serna Amorocho Mariana": "8-4",
    "Soler Castro SebastiÃ¡n": "8-4",
    "Uribe Juan Diego ": "8-4",
    "Borras Valero Mariana": "8-4",
    "Berrocal Agudelo Juan Felipe": "8-5",
    "Casas Cortes Sofia": "8-5",
    "Herrera SÃ¡nchez MarÃ­a Paula": "8-5",
    "Kiger De La Rosa Sophia": "8-5",
    "Ladino Chiquillo Fernanda": "8-5",
    "Lizarazo Naomi": "8-5",
    "Lopez Gutierrez Mariana": "8-5",
    "MartÃ­nez Giraldo Taliana": "8-5",
    "Molina Reyes Daniel": "8-5",
    "Monroy Romero Gabriel ": "8-5",
    "Morales CÃ¡rdenas Isabella": "8-5",
    "Perez Arbelaez Juan Felipe": "8-5",
    "Perez Becerra Catalina": "8-5",
    "Pinilla Salamanca Santiago": "8-5",
    "RÃ­os Tamayo Manuela": "8-5",
    "Romero LÃ³pez Alicia": "8-5",
    "Rozo TÃ©llez Juan SebastiÃ¡n": "8-5",
    "Vargas CerÃ³n Luana": "8-5",
    "Baene Senior Santiago": "9-1",
    "BohÃ³rquez BermÃºdez NicolÃ¡s": "9-1",
    "DÃ­az Garrido Daniel": "9-1",
    "DomÃ­nguez Cristiani Valeria": "9-1",
    "Duque Daza Valeria": "9-1",
    "FlÃ³rez RomÃ¡n Miguel JosÃ©": "9-1",
    "GÃ³mez Nova Karen SofÃ­a": "9-1",
    "Lizarazo Mateo": "9-1",
    "LÃ³pez Riascos MarÃ­a Paz": "9-1",
    "LÃ³pez RodrÃ­guez Santiago": "9-1",
    "MartÃ­nez Pinto Juliana SofÃ­a": "9-1",
    "Martinez Tellez Juan Jose": "9-1",
    "Mendoza Herrera Esteban": "9-1",
    "MuÃ±oz Parra Catalina": "9-1",
    "Orozco CortÃ©s JerÃ³nimo": "9-1",
    "Ospina Sanchez Emiliana": "9-1",
    "Parias Gomez Sofia": "9-1",
    "Sarmiento Rivera Gabriela": "9-1",
    "Serrano Roca Camilo": "9-1",
    "Tovar Varcacel Juan Pablo": "9-1",
    "Vergel De LeÃ³n SebastiÃ¡n": "9-1",
    "AmÃ©zquita Arciniegas Luciana": "9-2",
    "Buenaventura Chianca JoaquÃ­n Arthur": "9-2",
    "Cabrera Franco Jacobo": "9-2",
    "Calvete Soto SofÃ­a": "9-2",
    "CÃ¡rdenas Orjuela Isabella": "9-2",
    "GÃ³mez Ochoa Renata": "9-2",
    "Herrera Rojas MartÃ­n": "9-2",
    "JimÃ©nez RomÃ¡n Paloma": "9-2",
    "LondoÃ±o Bernaza Lucas": "9-2",
    "Madeira De Castro Davi": "9-2",
    "Mc Kenna RamÃ­rez John Michael": "9-2",
    "Melchior Gilles Charles Marie": "9-2",
    "Prajit Naik": "9-2",
    "RamÃ­rez Pacheco Kenny Alejandro": "9-2",
    "Rey Ortiz Sara Valentina": "9-2",
    "Rojas Reinoso Juan Jacobo": "9-2",
    "RoldÃ¡n CortÃ©s David": "9-2",
    "Rossi Garcia Renato": "9-2",
    "Vallejo CastaÃ±eda Luciano": "9-2",
    "Wilches Jaramillo David Eduardo": "9-2",
    "Alvarez Herrera David Alejandro": "9-3",
    "Ardila Rivera MarÃ­a Alejandra": "9-3",
    "Arias Zapata Ana MarÃ­a": "9-3",
    "Barcenas Nicolas": "9-3",
    "Bernal RodrÃ­guez Juan Felipe": "9-3",
    "Cardona Mantilla Ãngel": "9-3",
    "Cruz SÃ¡enz Brianna MarÃ­a": "9-3",
    "Cuellar Moreno FÃ¡tima Lucciana": "9-3",
    "GaitÃ¡n GÃ³mez Felipe": "9-3",
    "GarcÃ­a Barona Susana": "9-3",
    "GonzÃ¡lez Galvis Juan Pablo": "9-3",
    "LÃ³pez Serna Lorenzo": "9-3",
    "NiÃ±o Pinto Lorenzo": "9-3",
    "Obando PÃ©rez Laura": "9-3",
    "PatiÃ±o Puerta Juan Felipe": "9-3",
    "Real Manrique Ebalo SimÃ³n": "9-3",
    "RincÃ³n Trujillo Mariana": "9-3",
    "Zarza Carbonell MÃ³nica": "9-3",
    "Barbosa Guerra Gabriela": "9-4",
    "BarÃ³n CastaÃ±o Luna": "9-4",
    "Calle Cuevas Emiliano": "9-4",
    "Calle Ruiz Martina": "9-4",
    "CÃ¡rdenas Orjuela Paulina": "9-4",
    "CortÃ©s LÃ³pez Miguel MatÃ­as": "9-4",
    "Giraldo Taborda Isabella": "9-4",
    "GÃ³mez Bonilla Eduardo JosÃ©": "9-4",
    "GonzÃ¡lez Ãvila SofÃ­a": "9-4",
    "Herrera Rojas Felipe": "9-4",
    "Jaramillo Buitrago Valentina": "9-4",
    "Munevar Reyes Manuela": "9-4",
    "PinzÃ³n BarragÃ¡n SebastiÃ¡n": "9-4",
    "PinzÃ³n Manrique Silvana": "9-4",
    "Prada Torres Silvana": "9-4",
    "Prada Valencia Alejandro": "9-4",
    "SÃ¡nchez Escobar AndrÃ©s": "9-4",
    "Tavera Cotes SofÃ­a": "9-4",
    "Varela JimÃ©nez NicolÃ¡s": "9-4",
    "Zournadjian Maria": "9-4",
    "Arellano VarÃ³n NicolÃ¡s Alejandro": "9-5",
    "Ãrevalo Cardona Luciana": "9-5",
    "Balser David MatÃ­as": "9-5",
    "Betancur Morales Samuel": "9-5",
    "Capasso Rey Florencia": "9-5",
    "Castellanos MejÃ­a MarÃ­a JosÃ©": "9-5",
    "Daza Torres Alfonso Ignasio": "9-5",
    "Duque Paredes Santiago": "9-5",
    "Espitia SantamarÃ­a MartÃ­n": "9-5",
    "GarcÃ­a GÃ³mez Jacobo": "9-5",
    "GÃ³mez SÃ¡nchez SofÃ­a": "9-5",
    "MillÃ¡n Cuesta David Alejandro": "9-5",
    "Moncaleano Garavito Paula Jimena": "9-5",
    "PÃ©rez Quintero MartÃ­n": "9-5",
    "RamÃ­rez Rojas Mariana": "9-5",
    "Rojas Marulanda Samuel Leonardo": "9-5",
    "Salazar Bayona Laura Juliana": "9-5",
    "Segura Medina Jeronimo ": "9-5",
    "Solano JimÃ©nez Mateo": "9-5",
    "Van-Strahlen Muriel JosÃ© Pablo": "9-5",
    "CÃ¡ceres Moreno SofÃ­a": "10-1",
    "CÃ¡rdenas GaÃ±an Sara Valentina": "10-1",
    "DÃ­az Upegui SebastiÃ¡n": "10-1",
    "Duque Calixto Juan Antonio": "10-1",
    "Escobar DÃ­az Gabriela": "10-1",
    "Eslava Eslava Samuel": "10-1",
    "Espinosa Ruiz Maria Alejandra": "10-1",
    "Franco ChacÃ³n Juliana MarÃ­a": "10-1",
    "Franco Peralta Susana": "10-1",
    "Guevara Martinez Miguel Angel ": "10-1",
    "JimÃ©nez GarcÃ­a MarÃ­a Antonia": "10-1",
    "Lopez Garcia Juan Jose": "10-1",
    "MarÃ­a Gaviria Samuel": "10-1",
    "Sanchez Ospina Gabriela": "10-1",
    "Sarmiento Otero Luciana": "10-1",
    "Solorzano Pineda Valeria  ": "10-1",
    "Tapias Rojas Ana SofÃ­a": "10-1",
    "Uribe Guiza Lorenzo": "10-1",
    "Vargas Martinez Alejandro ": "10-1",
    "Zabala Diaz Isabella ": "10-1",
    "Zarza Carbonell Jaume": "10-1",
    "Alvarez GarcÃ­a Gabriela": "10-2",
    "Amaya GÃ³mez Mariana": "10-2",
    "Balser David Samuel": "10-2",
    "Ceron Rincon Mariana": "10-2",
    "Escobar Bernhard Ana MarÃ­a": "10-2",
    "FÃºquen Zarabanda JerÃ³nimo": "10-2",
    "Guzman Echeverri Emilio": "10-2",
    "Josephsen ChÃ¡vez Samuel": "10-2",
    "Juyar Prieto Cira Isabella ": "10-2",
    "Luque GarcÃ­a Federico": "10-2",
    "Mesa GonzÃ¡lez Juan Alejandro": "10-2",
    "Otalora GonzÃ¡lez Alejandra": "10-2",
    "Pertuz Schutt Mariana ": "10-2",
    "Pombo Cediel Sofia": "10-2",
    "RodrÃ­guez Verdugo Santiago": "10-2",
    "Rosero CastaÃ±o Gabriel": "10-2",
    "Salgado VÃ©lez Mateo": "10-2",
    "Sarmiento BogotÃ¡ Luciana ": "10-2",
    "Sierra Tarazona Paula Alejandra": "10-2",
    "Torres Gordillo Juan Andres": "10-2",
    "Umbarila Cabrera Valeria": "10-2",
    "Vargas Vidal Owen": "10-2",
    "Adaime Ochoa Manuela": "10-3",
    "Bastidas Medina Camilo Alejandro": "10-3",
    "Caycedo LeÃ³n Pablo AndrÃ©s": "10-3",
    "Correa Giraldo Gabriela": "10-3",
    "De La Espriella CÃ¡liz Salvatore ": "10-3",
    "DomÃ­nguez Cristiani Samuel": "10-3",
    "Eslava Obando SofÃ­a": "10-3",
    "Espinosa Balaguera MartÃ­n": "10-3",
    "GarzÃ³n RÃ­os TomÃ¡s": "10-3",
    "Guevara RodrÃ­guez Mateo": "10-3",
    "Higuera Palacios NicolÃ¡s": "10-3",
    "Lozano Ardila Mariana": "10-3",
    "Molina BohÃ³rquez Mariana": "10-3",
    "Molina Lugo Valeria": "10-3",
    "Muriel Caicedo Miranda": "10-3",
    "Ortiz Bonett Emilia": "10-3",
    "Ortiz Roesel Daniel ": "10-3",
    "PabÃ³n GÃ³mez Victoria": "10-3",
    "Rojas Silva Juanita": "10-3",
    "Salazar Gaviria Samuel": "10-3",
    "Tamayo Salazar TomÃ¡s": "10-3",
    "Tovar Cortes Samuel ": "10-3",
    "Valencia Bonilla Valentina": "10-3",
    "Andrade Juanita ": "10-4",
    "Bohorquez Villamil Catalina": "10-4",
    "Borras Rey Juan Camilo ": "10-4",
    "Camacho Castrillon Federico": "10-4",
    "Castillo Bastidas Tatiana": "10-4",
    "Ferrer Villota Sara": "10-4",
    "Lopez Moreno Samuel Alejandro ": "10-4",
    "Ortega Diaz Luna": "10-4",
    "PÃ¡ez Hoyos Valeria": "10-4",
    "PÃ©rez Castro Juan JosÃ©": "10-4",
    "Pinilla Ramirez Juan Esteban": "10-4",
    "Poveda BolaÃ±os Juan Sebastian": "10-4",
    "Quintero Franco SimÃ³n": "10-4",
    "RamÃ­rez Barrera Isabella ": "10-4",
    "Ramos CÃ¡ceres Isabela": "10-4",
    "Rebolledo Kerguelen NicolÃ¡s": "10-4",
    "Sanchez Tovar Ivanna": "10-4",
    "Shambo MartÃ­nez Annie": "10-4",
    "Sophia Valentina Spiliopulos Marfisi": "10-4",
    "Vanstrahlen DurÃ¡n Alejandra": "10-4",
    "Villamizar Bustamante Gabriel AndrÃ©s": "10-4",
    "Capasso Rey Facundo Daniel": "11-1",
    "De La Cruz Galvis MarÃ­a Del Pilar": "11-1",
    "Ferro LeÃ³n Valeria": "11-1",
    "Forero Escobar NicolÃ¡s": "11-1",
    "Giraldo Rivas Camila Isabella": "11-1",
    "Gravini RodrÃ­guez Amaranta Carolina": "11-1",
    "Ladino MuÃ±oz Carlos DarÃ­o": "11-1",
    "Loaiza NiÃ±o Juan David": "11-1",
    "Mejia Navas Sara Luna": "11-1",
    "MillÃ¡n Cuesta AndrÃ©s Felipe": "11-1",
    "Nishizawa Duque Saya Valentina": "11-1",
    "Obando PÃ©rez Emilio": "11-1",
    "Rojas Vargas MarÃ­a Paula": "11-1",
    "Sanchez Ospino Maximiliano ": "11-1",
    "Seth Soham Vishal": "11-1",
    "Silva Mendoza Camila Del Mar": "11-1",
    "Tovar Urdinola Laura Patricia": "11-1",
    "AlarcÃ³n Cepeda Ricardo ": "11-2",
    "Benejam Graterol BÃ¡rbara": "11-2",
    "Bento Ramos Mariana Isabella": "11-2",
    "Carvajal Polo Samuel ": "11-2",
    "Casado De Lamadrid Paloma": "11-2",
    "Chica MuÃ±oz Lorenzo ": "11-2",
    "DÃ­az Arias Samuel Esteban": "11-2",
    "Donoso De Lima Marianna": "11-2",
    "LÃ³pez GarcÃ­a Juliana": "11-2",
    "MartÃ­n Cadavid Samuel": "11-2",
    "Moreno PatiÃ±o Daniela": "11-2",
    "Murillo HincapiÃ© Samuel": "11-2",
    "Natale Lapelosa Fabrizio": "11-2",
    "Perez Becerra Maria Alejandra": "11-2",
    "Price Betancourt Daniella MarÃ­a": "11-2",
    "Quintana GÃ¡mez Camilo Alejandro": "11-2",
    "Serna Amorocho Alejandro": "11-2",
    "Sorzano Saker Manuela": "11-2",
    "Wilches HernÃ¡ndez Juan AndrÃ©s": "11-2",
    "YamÃ­n Delgado Santiago": "11-2",
    "Alzate GÃ³mez Valentina": "11-3",
    "BeltrÃ¡n RamÃ­rez Juan Esteban": "11-3",
    "BenÃ­tez Navarro Daniel AndrÃ©s": "11-3",
    "Berrocal Agudelo Leonardo": "11-3",
    "Calle Ruiz Emiliana": "11-3",
    "Escobar Cervantes Juanita": "11-3",
    "Gallo GarcÃ­a David Felipe": "11-3",
    "Granada RincÃ³n Valeria": "11-3",
    "Lacouture ElÃ­as Mariana": "11-3",
    "LÃ³pez Murillo Alejandro": "11-3",
    "Molina Reyes Ana SofÃ­a": "11-3",
    "MonzÃ³n Parada SofÃ­a Alejandra": "11-3",
    "PÃ©rez Quintero Samuel": "11-3",
    "Prieto RodrÃ­guez Juan AndrÃ©s": "11-3",
    "Rozo Lerzundy SofÃ­a": "11-3",
    "Sandoval RamÃ­rez Samuel": "11-3",
    "Scavrone Da Cruz Bonato Valentina": "11-3",
    "Soto RodrÃ­guez Juan Pablo": "11-3",
    "Valenzuela Burbano Felipe": "11-3",
    "Zournadjian Sofia": "11-3",
    "Bossa Jattin Zulema MarÃ­a": "11-4",
    "Castillo MuÃ±oz Sara ": "11-4",
    "Diaz Mendez AndrÃ©s": "11-4",
    "Duerr Roa Emily Andrea": "11-4",
    "Ferrari Cranwell Clara": "11-4",
    "GarcÃ­a CÃ³rdoba Miguel Santiago": "11-4",
    "GarcÃ­a Montoya Mariana": "11-4",
    "Herrera GÃ³mez Mariana": "11-4",
    "Janssen Villegas Pietro Roberto": "11-4",
    "JimÃ©nez Barbosa Ana SofÃ­a": "11-4",
    "Manrique CÃ¡rdenas NicolÃ¡s": "11-4",
    "Ortiz Olarte Miguel Ãngel": "11-4",
    "Rattner Prieto Monique ": "11-4",
    "Reyna RincÃ³n Sara SofÃ­a": "11-4",
    "RodrÃ­guez Moreno SofÃ­a": "11-4",
    "SÃ¡nchez Bonilla Juan JosÃ©": "11-4",
    "SÃ¡nchez Tovar Ilona": "11-4",
    "Silva Mendoza Isabel SofÃ­a": "11-4",
    "SuÃ¡rez Castro Alejandra": "11-4",
    "Villalba Velandia Isabella Panambi": "11-4",
    "Aguirre Caiza Paula": "11-5",
    "Aguirre Forero NicolÃ¡s": "11-5",
    "Fajardo Alba NicolÃ¡s": "11-5",
    "Fefer RodrÃ­guez Yael": "11-5",
    "Goldsztayn Bernal Sarah": "11-5",
    "GonzÃ¡lez Upegui Felipe": "11-5",
    "Izquierdo Ortega Felipe": "11-5",
    "Kiger de la Rosa Natalia": "11-5",
    "LeÃ³n Guarnizo Gabriela ": "11-5",
    "Leonel Picker Violeta": "11-5",
    "Maya Salas Mariana": "11-5",
    "PÃ¡ez Sorzano SofÃ­a": "11-5",
    "Rozo TÃ©llez Ana Camila": "11-5",
    "Rueda Charry TomÃ¡s": "11-5",
    "Serrano Roca Valeria": "11-5",
    "Vargas Arias Valentina": "11-5",
    "Vecino Barranco Juan Diego": "11-5",
    "Vergel De LeÃ³n Marianna": "11-5",
    "Wattamwar Tejas Raman": "11-5",
}

# Define valid grades
valid_grades = ["QUINTO", "SEXTO", "SEPTIMO", "OCTAVO", "NOVENO", "DECIMO", "ONCE"]

def normalize_name(name):
    name = name.lower().strip()
    name = re.sub(r'[^a-zÃ¡Ã©Ã­Ã³ÃºÃ± ]', '', name)
    return name

def split_name_parts(name):
    return set(normalize_name(name).split())

def extract_students_info(text):
    pattern = r"Pasajero:\s([A-ZÃÃ‰ÃÃ“ÃšÃ‘ ]+)\sCurso:\s([A-ZÃÃ‰ÃÃ“ÃšÃ‘]+)"
    matches = re.findall(pattern, text)
    return [(match[0].strip(), match[1].strip()) for match in matches]

def find_best_match(name, grade):
    pdf_name_parts = split_name_parts(name)
    best_match = None
    highest_score = 0

    for master_name in master_list.keys():
        master_name_parts = split_name_parts(master_name)
        common_parts = pdf_name_parts.intersection(master_name_parts)
        score = len(common_parts) / max(len(pdf_name_parts), len(master_name_parts)) * 100

        fuzzy_score = fuzz.token_sort_ratio(name, master_name)
        final_score = max(score, fuzzy_score)

        if final_score > highest_score:
            highest_score = final_score
            best_match = master_name

    assigned_class = master_list.get(best_match, "Not Found") if highest_score > 40 else "Not Found"
    return assigned_class

# File uploader
uploaded_file = st.file_uploader("Upload a PDF", type="pdf")

if uploaded_file:
    with pdfplumber.open(uploaded_file) as pdf:
        full_text = "\n".join([page.extract_text() for page in pdf.pages if page.extract_text()])

    # Extract student data
    students_list = extract_students_info(full_text)
    df = pd.DataFrame(students_list, columns=["Name", "Grade"])
    df = df[df["Grade"].isin(valid_grades)].drop_duplicates()

    for i, row in df.iterrows():
        df.at[i, "Class"] = find_best_match(row["Name"], row["Grade"])

    df = df.sort_values(by=["Class", "Name"], ascending=[True, True])

    # Save as CSV
    csv_file = "students_list.csv"
    df.to_csv(csv_file, index=False)

    # Generate Google Sheets Import URL
    csv_url = f"https://raw.githubusercontent.com/YOUR_GITHUB_USERNAME/YOUR_REPO/main/{csv_file}"
    google_sheets_url = f"https://docs.google.com/spreadsheets/u/0/create?import={urllib.parse.quote(csv_url)}"

    # Display dataframe
    st.write("### Processed Student List")
    st.dataframe(df)

    # Provide link to open in Google Sheets
    st.markdown(f"[ðŸ“„ Open in Google Sheets]({google_sheets_url})", unsafe_allow_html=True)
